---
import { incrementViews } from "@/db/client";

interface Props {
  slug: string;
  shouldIncrement?: boolean;
}

const { env } = Astro.locals.runtime;
const { slug, shouldIncrement = false } = Astro.props;

const data = await Astro.locals.loaders.blogViews.load(slug);
const count: number = ((data && data["view_count"]) || 0) as number;

if (shouldIncrement) {
  await incrementViews(env.DB, slug);
}
---

{count.toLocaleString()}{" "}{count === 1 ? "view" : "views"}
