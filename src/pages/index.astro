---
import { Image, Picture } from "@astrojs/image/components";
import Layout from "@layouts/Layout.astro";
import avatar from "@assets/images/avatar.jpg";
import { Icon } from "astro-icon";
import ArticleFooter from "@components/ArticleFooter.astro";
import type { PostFrontmatter } from "src/types";
import { getPosts } from "src/api";
import Article from "@components/Article.astro";

const posts = await getPosts(
  await Astro.glob<PostFrontmatter>("./blog/**/index.mdx")
);

const featured = posts[0];
const restOfPosts = posts.slice(1);
---

<Layout
  openGraph={{
    basic: {
      title: "Nicholas Ray",
      type: "website",
      image: new URL("/avatar.jpg", Astro.url),
    },
    image: {
      alt: "Profile picture of Nicholas Ray",
      // Needed to prevent Astro SEO from outputting blank height tag.
      height: null,
    },
  }}
  twitter={{
    card: "summary_large_image",
  }}
>
  <main class="space-y-20 overflow-hidden sm:space-y-32 md:space-y-40">
    <section class="mt-12 lg:mt-16">
      <div
        class="mx-auto max-w-7xl items-center space-y-12 px-4 sm:px-6 md:grid md:grid-cols-[30rem_30rem] md:gap-14 md:space-y-0 md:px-8 lg:grid-cols-[36.25rem_36.25rem]"
      >
        <div class="md:col-start-2">
          <a
            href={featured.url}
            class="block md:rotate-2 md:transition-performant md:duration-300 md:hover:rotate-0"
          >
            <Picture
              class="w-full rounded-3xl h-80 md:h-[34rem] object-cover shadow-lg"
              loading="eager"
              alt={featured.frontmatter.cover.alt}
              src={featured.frontmatter.cover.src}
              aspectRatio={featured.frontmatter.cover.width /
                featured.frontmatter.cover.height}
              width={featured.frontmatter.cover.width}
              height={featured.frontmatter.cover.height}
              widths={[400, 800, 1200]}
              sizes="(min-width: 48rem) 37rem, 100vw"
            />
          </a>
        </div>
        <div class="md:row-start-1">
          <article>
            <a href={featured.url}>
              <h1
                class="text-4xl font-bold tracking-tight text-white lg:text-5xl"
              >
                {featured.frontmatter.title}
              </h1>
            </a>
            <p class="mt-8 text-xl text-zinc-300 lg:text-2xl">
              {featured.frontmatter.description}
            </p>

            <footer class="mt-10 text-sm uppercase tracking-wide text-zinc-400">
              <ArticleFooter
                publishedAt={featured.frontmatter.publishedAt}
                readingTime={featured.frontmatter.readingTime}
              />
            </footer>
          </article>
          <a
            href={featured.url}
            class="relative z-10 mt-14 inline-flex w-full min-w-[12rem] items-center justify-center rounded-full bg-zinc-50 py-5 px-6 text-lg font-semibold text-slate-900 md:w-auto md:transition-performant md:duration-300 md:hover:scale-[1.1] md:active:translate-y-1"
          >
            Read article</a
          >
        </div>
      </div>
    </section>
    <section>
      <div class="mx-auto max-w-7xl px-4 sm:px-6 md:px-8">
        <div class="flex items-center justify-between">
          <Icon class="w-12 h-12 text-zinc-700" name="typescript" />
          <Icon class="w-12 h-12 text-zinc-700" name="js" />
          <Icon class="w-12 h-12 text-zinc-700" name="node" />
          <Icon class="w-12 h-12 text-zinc-700" name="html" />
          <Icon class="w-12 h-12 text-zinc-700" name="css" />
          <Icon class="w-12 h-12 text-zinc-700" name="react" />
        </div>
        <div class="mt-8 md:mt-20">
          <div
            class="flex max-w-5xl flex-col items-center gap-8 md:flex md:flex-row md:items-center md:gap-16"
          >
            <Image
              class="w-[100px] md:w-[120px] rounded-full border-4 border-zinc-400"
              src={avatar}
              width={240}
              alt="Avatar of Nicholas Ray"
            />
            <div>
              <h2
                class="text-3xl font-semibold tracking-tight text-white md:text-4xl"
              >
                Hi, I'm Nicholas Ray
              </h2>
              <p class="mt-5 text-xl text-zinc-300 md:text-2xl">
                With over 8 years of experience in web development, I share what
                Iâ€™ve learned throughout my career on this site to help you
                become a better developer.
              </p>
            </div>
          </div>
          <div class="mt-12 flex">
            <a
              class="text-xl font-semibold text-white md:ml-[calc(120px+4rem)]"
              href="/about"
            >
              Learn more about me &rarr;
            </a>
          </div>
        </div>
      </div>
    </section>
    <section>
      <div class="mx-auto max-w-7xl px-4 sm:px-6 md:px-8">
        <h2
          class="relative text-base font-semibold uppercase tracking-wide text-white before:absolute before:-top-2 before:block before:h-[3px] before:w-[48px] before:bg-zinc-400"
        >
          Recently Published
        </h2>
        <ul
          class="mt-12 grid grid-cols-[repeat(auto-fill,minmax(350px,1fr))] gap-9"
        >
          {
            restOfPosts.map((post) => (
              <li>
                <Article post={post} />
              </li>
            ))
          }
        </ul>
      </div>
    </section>
  </main>
</Layout>
