---
import { Image, Picture } from "@astrojs/image/components";
import Layout from "@layouts/Layout.astro";
import type { MDXInstance } from "astro";
import { compareDesc, format } from "date-fns";
import avatar from "@assets/images/avatar.jpg";
import { Icon } from "astro-icon";

interface Frontmatter {
  title: string;
  description: string;
  publishedAt: string;
  readingTime: string;
  draft?: boolean;
}

interface Post extends MDXInstance<Frontmatter> {
  cover: {
    metadata: ImageMetadata;
    alt: string;
  };
}

const posts = (await Astro.glob<Frontmatter>("./blog/**/index.mdx"))
  .filter((post) => !post.frontmatter.draft)
  .sort((a, b) => {
    return compareDesc(
      new Date(a.frontmatter.publishedAt || new Date()),
      new Date(b.frontmatter.publishedAt || new Date())
    );
  }) as Post[];

const featured = posts[0];
const restOfPosts = posts.slice(1);
---

<Layout title="nray">
  <main>
    <section
      class="mx-auto flex max-w-7xl items-center px-4 sm:px-6 md:px-8 lg:grid lg:grid-cols-2 lg:gap-14"
    >
      <div>
        <h1 class="text-5xl font-bold tracking-tight text-white">
          {featured.frontmatter.title}
        </h1>
        <p class="mt-8 text-2xl text-zinc-300">
          {featured.frontmatter.description}
        </p>
        <a
          href={featured.url}
          class="relative z-10 mt-14 inline-flex w-full min-w-[12rem] items-center justify-center rounded-full bg-zinc-50 py-5 px-6 text-lg font-semibold text-slate-900 md:w-auto"
        >
          Read article</a
        >
      </div>
      <div>
        <Picture
          alt=""
          class="w-full rounded-3xl h-[34rem] object-cover shadow-lg"
          src={featured.cover.metadata}
          width={featured.cover.metadata.width}
          height={featured.cover.metadata.height}
          widths={[400, 800, 1600]}
          sizes="(min-width: 48rem) 37rem, 100vw"
        />
      </div>
    </section>
    <section
      class="mx-auto mt-40 flex max-w-7xl items-center justify-between px-4 sm:px-6 md:px-8"
    >
      <Icon class="w-12 h-12 text-zinc-700" name="typescript" />
      <Icon class="w-12 h-12 text-zinc-700" name="js" />
      <Icon class="w-12 h-12 text-zinc-700" name="node" />
      <Icon class="w-12 h-12 text-zinc-700" name="html" />
      <Icon class="w-12 h-12 text-zinc-700" name="css" />
      <Icon class="w-12 h-12 text-zinc-700" name="react" />
    </section>
    <section class="mx-auto mt-20 max-w-7xl px-4 sm:px-6 md:px-8">
      <div class="flex max-w-5xl items-center gap-16">
        <Image
          class="w-[120px] rounded-full border-4 border-zinc-400"
          src={avatar}
          width={240}
          alt="Avatar of Nicholas Ray"
        />
        <div>
          <h2 class="text-4xl font-semibold tracking-tight text-white">
            Hi, I'm Nicholas Ray
          </h2>
          <p class="mt-5 text-2xl text-zinc-300">
            With over 8 years of experience in web development, I share what
            Iâ€™ve learned throughout my career on this site to help you become a
            better developer.
          </p>
        </div>
      </div>
      <div class="mt-12 flex">
        <a
          class="ml-[calc(120px+4rem)] text-xl font-semibold text-white"
          href="/about"
        >
          Learn more about me &rarr;
        </a>
      </div>
    </section>
    <section class="mx-auto mt-40 max-w-7xl px-4 sm:px-6 md:px-8">
      <h2
        class="relative text-base font-semibold uppercase tracking-wide text-white before:absolute before:-top-2 before:block before:h-[3px] before:w-[48px] before:bg-pink-400"
      >
        Recently Published
      </h2>
      <ul
        class="mt-8 grid grid-cols-[repeat(auto-fill,minmax(350px,1fr))] gap-9"
      >
        {
          restOfPosts.map((post) => (
            <li>
              <a href={post.url}>
                <article class="flex h-full flex-col">
                  <div class="rounded-3xl">
                    <Picture
                      alt=""
                      class="h-[34rem] w-full rounded-3xl object-cover shadow-lg"
                      src={post.cover.metadata}
                      width={post.cover.metadata.width}
                      height={post.cover.metadata.height}
                      widths={[400, 800, 1600]}
                      sizes="(min-width: 48rem) 28rem, 100vw"
                    />
                  </div>
                  <h3 class="mt-8 text-2xl font-semibold tracking-tight text-white">
                    {post.frontmatter.title}
                  </h3>
                  <p class="mt-4 mb-6 text-lg text-zinc-300">
                    {post.frontmatter.description}
                  </p>
                  <footer class="mt-auto text-sm uppercase tracking-wide text-zinc-500">
                    <time datetime={post.frontmatter.publishedAt}>
                      {format(
                        new Date(post.frontmatter.publishedAt),
                        "LLLL d, yyyy"
                      )}
                    </time>
                    <span>&bull;</span>
                    <span>{post.frontmatter.readingTime}</span>
                  </footer>
                </article>
              </a>
            </li>
          ))
        }
      </ul>
    </section>
  </main>
</Layout>
